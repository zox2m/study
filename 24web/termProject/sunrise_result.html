<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>일출 일몰 시각 검색 결과</title>
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <header>
        <h1>일출 일몰 시각 검색 결과</h1>
    </header>
    
    <nav>
        <a href="index.html">HOME</a>
        <a href="astro.html">천문현상 검색</a>
        <a href="sunrise.html">일출 일몰 시각 검색</a>
    </nav>

    <main>
        
        <!-- table 사용 -->
        <table>
            <thead>
                <tr>
                    <th>일출 시각</th>
                    <th>일몰 시각</th>
                    <th>월출 시각</th>
                    <th>월몰 시각</th>
                </tr>
            </thead>
            <tbody id="results">
                <!-- API 결과가 여기에 추가됩니다 -->
            </tbody>
        </table>
    </main>

    <footer>
        <p><i>Copyright @ 2024 Jumin Seo</i></p>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            var date = new URLSearchParams(window.location.search).get('date');
            var latitude = new URLSearchParams(window.location.search).get('latitude');
            var longitude = new URLSearchParams(window.location.search).get('longitude');
            var serviceKey = 'fC5An%2BEN3x%2F1TJZyWrX9IB1%2BPDtQxZeFu9LwWWX9S%2FpQSjZPkpR5e8DEz%2FBUfEEE3o%2BCSmJmJt8VXpG3sKN9Og%3D%3D'; // 서비스 키

            // 일출 일몰 시각 API 호출
            $.ajax({
                url: 'http://apis.data.go.kr/B090041/openapi/service/RiseSetInfoService/getLCRiseSetInfo',
                method: 'GET',
                data: {
                    locdate: date.replace(/-/g, ''),
                    latitude: latitude,
                    longitude: longitude,
                    ServiceKey: serviceKey,
                },
                success: function(data) {
                    var results = $('#results');
                    $(data).find('item').each(function() {
                        var sunrise = $(this).find('sunrise').text();
                        var sunset = $(this).find('sunset').text();
                        var moonrise = $(this).find('moonrise').text();
                        var moonset = $(this).find('moonset').text();
                        
                        results.append('<tr><td>' + sunrise + '</td><td>' + sunset + '</td><td>' + moonrise + '</td><td>' + moonset + '</td></tr>');
                    });
                },
                error: function(xhr, status, error) {
                    if (xhr.status === 0) {
                        alert('네트워크에 연결할 수 없습니다. 인터넷 연결을 확인하세요.');
                    } else if (xhr.status >= 500) {
                        alert('서버 오류가 발생했습니다. 나중에 다시 시도해주세요.');
                    } else {
                        alert('데이터를 가져오는 데 실패했습니다. 다시 시도해 주세요.');
                    }
                    console.error('에러 메시지:', status, error);
                }
            });
        });
    </script>
</body>
</html>
